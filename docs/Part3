ابتدا لازم است برای این کار، کاری کنیم که هر یک از فرآیند های create و write به صورتی عمل کنند که هیچ دو ریسمانی با هم در نواحی بحرانی نباشند. برای این کار لازم است تا ابتدا دو سمافور تعریف کنیم.یکی create_mutex و دیگری mutex که برای هر root_dir_block تعریف می شود.
[pic1-1]
سپس باید در تابع fs_create ابتدا روی سمافور create_mutex ویت شود و هر جا که لازم شد از تابع خارج شویم، قبل از آن سمافور پست شود. کد آن مطابق زیر است.
[pic3-1]
همچنین مطابق شکل زیر در تابع fs_write بعد از آن که مطمئن می شویم که اسم فایل ارور های لازم را ندارد، سمافور mutex را ویت می کنیم. پس از آن ادامه ی تابع را انجام می دهیم و هر بار قبل از خروج از تابع سمافور را پست می کنیم.
[pic3-2]
