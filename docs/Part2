ابتدا لازم است برای این کار، کاری کنیم که هر یک از فرآیند های create و open به صورتی عمل کنند که هیچ دو ریسمانی با هم در نواحی بحرانی نباشند. برای این کار لازم است تا ابتدا دو سمافور تعریف کنیم.
[pic3-1]
سپس باید در تابع fs_create ابتدا روی سمافور create_mutex ویت شود و هر جا که لازم شد از تابع خارج شویم، قبل از آن سمافور پست شود. کد آن مطابق زیر است.
[pic3-2]
همچنین مطابق شکل زیر در تابع fs_open بعد از آن که مطمئن می شویم که اسم فایل ارور های لازم را ندارد، سمافور open_mutex را ویت می کنی. پس از آن چک می کنیم که آیا آن فایل پیش از این باز است یا خیر. اگر بود پس از نمایش ارور، سمافور را پست کرده و سپس خارج می شویم. اما اگر فایل از پیش باز نباشد، کار را ادامه می دهیم و قبل از خروج از تابع، سمافور را پست می کنیم.
[pic3-3]

لازم به ذکر است در این کار از تابع از پیش نوشته شده ی is_open که در کد وجود داشت استفاده کرده ایم.
